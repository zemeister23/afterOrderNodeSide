{"version":3,"sources":["../src/helper.js"],"names":["uint32Max","Math","pow","runningInNode","window","FormData","require","Helper","obj","str","property","Object","prototype","hasOwnProperty","call","push","encodeURIComponent","join","min","max","x","random","floor","number","Array","slice","Date","now","getTime","pad","mtRand","MIN","MAX","args","url","key","secret","version","appendArguments","serialize","method","fetchService","callApi","error","api_nonce","apiNonce","api_timestamp","timestamp","api_key","api_signature","sign","api_kit","action","createUrl","dataOrStream","getDataFrom","then","data","formData","append","maxDataSize","Infinity","maxBodyLength","maxContentLength","uploadFile","Promise","resolve","reject","Buffer","from","on","chunk","concat","err","helper"],"mappings":"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","sourcesContent":["import SHA1 from 'crypto-js/sha1'\r\nimport { MIN, MAX } from './constants'\r\nimport { fetchService } from './fetch'\r\n//import { runningInNode } from './helper'\r\n\r\nconst uint32Max = Math.pow(2, 32)\r\n\r\nexport const runningInNode = (typeof window === 'undefined')\r\n\r\nconst FormData = (runningInNode) ? require(/* webpackExclude: /form-data$/ */ 'form-data') : window.FormData\r\n\r\nexport default class Helper {\r\n  serialize (obj) {\r\n    const str = []\r\n    for (const property in obj) {\r\n      if (Object.prototype.hasOwnProperty.call(obj, property)) {\r\n        str.push(`${encodeURIComponent(property)}=${encodeURIComponent(obj[property])}`)\r\n      }\r\n    }\r\n    return str.join('&')\r\n  }\r\n\r\n  mtRand (min, max) {\r\n    const x = Math.random()\r\n    return Math.floor(x * (max - min + 1)) + min\r\n  }\r\n\r\n  pad (number, str) {\r\n    return (str + Array(number).join('0')).slice(0, number)\r\n  }\r\n\r\n  timestamp () {\r\n    if (!Date.now) {\r\n      Date.now = () => { return Math.floor(new Date().getTime() / 1000) }\r\n    }\r\n    return Math.floor(Date.now() / 1000)\r\n  }\r\n\r\n  apiNonce () {\r\n    return this.pad(8, this.mtRand(MIN, MAX))\r\n  }\r\n\r\n  createUrl (call, args = [], url, key, secret, version) {\r\n    args = this.appendArguments(args, key, secret, version)\r\n    if (call[0] !== '/')\r\n      call = '/' + call\r\n    return `${url}${call}?${this.serialize(args)}`\r\n  }\r\n\r\n  callApi (url, method) {\r\n    return fetchService.callApi(url, method)\r\n      .catch((error) => { throw error })\r\n  }\r\n\r\n  appendArguments (args, key, secret, version) {\r\n    args.api_nonce = this.apiNonce()\r\n    args.api_timestamp = this.timestamp()\r\n    args.api_key = key\r\n    args.api_signature = this.sign(args, secret)\r\n    args.api_kit = `JS${version}`\r\n\r\n    return args\r\n  }\r\n\r\n  sign (args, secret) {\r\n    return SHA1(`${args.api_timestamp}${args.api_nonce}${secret}`)\r\n  }\r\n\r\n  getUrlForFileCreation (action, args, url, key, secret, version) {\r\n    if (action === 'file') {\r\n      url = this.createUrl('/files/create', args, url, key, secret, version)\r\n    } else if (action === 'watermark') {\r\n      url = this.createUrl('/watermarks/create', args, url, key, secret, version)\r\n    }\r\n    return url\r\n  }\r\n\r\n  // dataOrStream can be a Node Buffer, stream, or a string or Blob (or Blob subclasses such as File) in the browser.\r\n  uploadFile (dataOrStream, url) {\r\n    return this.getDataFrom(dataOrStream).then(data => {\r\n      const formData = new FormData()\r\n      if (runningInNode)\r\n        formData.append('file', data, 'file') //node requrirement\r\n      else\r\n        formData.append('file', data) // >1gb size issue, file as name param must be off\r\n      formData.maxDataSize = Infinity\r\n      formData.maxBodyLength = Infinity\r\n      formData.maxContentLength = Infinity\r\n      return fetchService.uploadFile(formData, url)\r\n    })\r\n  }\r\n\r\n  getDataFrom (dataOrStream) {\r\n    return new Promise((resolve, reject) => {\r\n      if (!runningInNode || dataOrStream instanceof Buffer || typeof dataOrStream === 'string') {\r\n        resolve(dataOrStream)\r\n      } else {\r\n        let data = Buffer.from([])\r\n        dataOrStream.on('data', chunk => { data = Buffer.concat([data, chunk]) })\r\n        dataOrStream.on('end', () => resolve(Buffer.from(data)))\r\n        dataOrStream.on('error', err => reject(err))\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nexport const helper = new Helper()\r\n"],"file":"helper.js"}